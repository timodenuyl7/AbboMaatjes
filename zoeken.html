<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zoeken — AbboMaatjes</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing:border-box; margin:0; padding:0; font-family:'Poppins', sans-serif; }
    body { background:#f5f5f5; color:#333; }

    /* --- Header --- */
    .header { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.05); position:sticky; top:0; z-index:100; }
    .logo-mark { font-weight:700; font-size:1.5rem; color:#1e5631; cursor:pointer; display:flex; align-items:center; gap:8px; }
    #siteTitle { cursor:pointer; font-weight:600; color:#1e5631; }
    .header-right { display:flex; gap:10px; align-items:center; }

    /* --- Flags --- */
    .lang-flags img { cursor:pointer; width:20px; height:14px; }

    /* --- Container --- */
    .container { max-width:1000px; margin:2rem auto; padding:0 1rem; display:grid; gap:2rem; }

    /* --- Card Styles --- */
    .card { background: linear-gradient(135deg, #e6f0ea, #ffffff); border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:1rem 1.5rem; transition:transform 0.2s, box-shadow 0.2s; }
    .card:hover { transform:translateY(-3px); box-shadow:0 6px 18px rgba(0,0,0,0.12); }

    .card img { width:56px; height:56px; border-radius:8px; }
    .card h3 { font-size:1.2rem; margin-bottom:0.25rem; }
    .card p { font-size:1rem; color:#555; }
    .ad-actions { display:flex; gap:0.5rem; margin-top:0.75rem; flex-wrap:wrap; }
    .ad-actions button { flex:1; min-width:100px; }

    /* --- Buttons --- */
    .small-btn { background-color:#1e5631; color:#fff; border:none; border-radius:6px; padding:0.5rem 1rem; cursor:pointer; font-weight:600; transition:background 0.2s; }
    .small-btn:hover { background-color:#144220; }
    .small-btn.secondary { background-color:#f0f0f0; color:#333; }
    .small-btn.secondary:hover { background-color:#e0e0e0; }

    /* --- Pills --- */
    .pills { margin-top:0.5rem; display:flex; gap:4px; }
    .pill { width:12px; height:12px; border-radius:50%; display:inline-block; }
    .pill.taken { background-color:#1e5631; }
    .pill.free { background-color:#e0e0e0; }

    /* --- Filter Form --- */
    #filterForm { display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap; margin-bottom:1rem; }
    #filterForm label { font-weight:500; }
    #filterSelect { padding:0.5rem; border-radius:6px; border:1px solid #ccc; font-size:1rem; }

    /* --- Grid --- */
    .grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); }

    /* --- Back Link --- */
    .back { display:inline-block; margin-top:1rem; text-decoration:none; color:#1e5631; font-weight:600; transition:color 0.2s; }
    .back:hover { color:#144220; }

    .filter-container { display:flex; justify-content:space-between; flex-wrap:wrap; gap:1rem; }
  </style>
</head>
<body>

<header class="header">
  <div class="header-left" id="homeLink" style="display:flex;align-items:center;gap:0.5rem;">
    <div class="logo-mark" id="logoMark">€ AbboMaatjes</div>
    <div><h1 id="siteTitle">AbboMaatjes</h1></div>
  </div>
  <div class="header-right" id="headerRight">
    <a class="login-link" href="login.html" id="loginLink">Login</a>
    <!-- Language flags -->
    <div class="lang-flags" style="display:flex; gap:6px;">
      <img src="https://flagcdn.com/w20/nl.png" onclick="doGTranslate('nl|nl');" alt="Nederlands">
      <img src="https://flagcdn.com/w20/gb.png" onclick="doGTranslate('nl|en');" alt="English">
    </div>
  </div>
</header>

<!-- Hidden Google Translate -->
<div id="google_translate_element" style="display:none;"></div>

<main class="container">
  <div class="card">
    <h2>Advertenties</h2>
    <div class="filter-container">
      <form id="filterForm">
        <label for="filterSelect">Filter op dienst</label>
        <select name="dienst" id="filterSelect">
          <option value="all">Alle</option>
          <option value="Netflix">Netflix</option>
          <option value="Spotify Family">Spotify Family</option>
          <option value="Disney+">Disney+</option>
          <option value="Duolingo Family">Duolingo Family</option>
        </select>
        <button class="small-btn" type="submit">Filter</button>
      </form>
      <button id="resetAll" class="small-btn secondary">Verwijder alle advertenties</button>
    </div>
  </div>

  <div id="results" class="grid"></div>
  <a class="back" href="index.html">⬅️ Terug naar homepage</a>
</main>

<!-- Google Translate Script -->
<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<script>
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({pageLanguage:'nl', includedLanguages:'nl,en', autoDisplay:false}, 'google_translate_element');
  }
  function doGTranslate(langPair) {
    if(langPair.value) langPair=langPair.value;
    var lang = langPair.split('|')[1];
    var select = document.querySelector("select.goog-te-combo");
    if(select && select.options.length>0){
      select.value = lang;
      select.dispatchEvent(new Event("change"));
    }
  }
</script>

<script>
  // Header links
  document.getElementById('homeLink').addEventListener('click', ()=>{ window.location.href='index.html'; });
  document.getElementById('logoMark').addEventListener('click', ()=>{ window.location.href='index.html'; });
  document.getElementById('siteTitle').addEventListener('click', ()=>{ window.location.href='index.html'; });

  const headerRight = document.getElementById('headerRight');
  const user = JSON.parse(localStorage.getItem('abbo_user')||'null');
  if(user && user.name){
    headerRight.innerHTML = '<div style="font-weight:600">Welkom, '+user.name+'</div>';
  }

  function renderAd(ad, idx){
    const el = document.createElement('div');
    el.className='card';
    let pillsHtml='<div class="pills">';
    const total=parseInt(ad.totaalMensen||0);
    const free=parseInt(ad.vrijePlekken||0);
    const taken=Math.max(0,total-free);
    for(let i=0;i<taken;i++){ pillsHtml+='<span class="pill taken" title="Bezet"></span>'; }
    for(let i=0;i<free;i++){ pillsHtml+='<span class="pill free" title="Vrij"></span>'; }
    pillsHtml+='</div>';

    el.innerHTML=`
      <div style="display:flex; gap:12px; align-items:center;">
        <img src="${ad.logo || 'https://cdn.simpleicons.org/netflix/E50914'}" alt="">
        <div style="flex:1">
          <h3>${ad.dienstNaam}</h3>
          <p>Totaal: €${ad.totaalPrijs} — Per persoon: €${ad.ppPrijs}</p>
        </div>
      </div>
      ${pillsHtml}
      <div class="ad-actions">
        <button class="small-btn" data-idx="${idx}" onclick="goDetail(this)">Reageren</button>
        <button class="small-btn secondary" data-idx="${idx}" onclick="toggleFav(this)">Favoriet</button>
        <button class="small-btn secondary" data-idx="${idx}" onclick="removeAd(this)">Verwijder</button>
      </div>`;
    return el;
  }

  function loadAll(filter){
    const container=document.getElementById('results');
    container.innerHTML='';
    const ads=JSON.parse(localStorage.getItem('abbo_ads')||'[]');
    let list=ads;
    if(filter && filter!=='all'){ list=ads.filter(a=>a.dienstNaam===filter); }
    if(list.length===0){ container.innerHTML='<div class="card">Geen advertenties gevonden.</div>'; return; }
    list.forEach((ad,idx)=>{ container.appendChild(renderAd(ad,idx)); });
  }

  function goDetail(btn){ const idx=btn.getAttribute('data-idx'); localStorage.setItem('abbo_selected',idx); window.location.href='advertentie.html?id='+idx; }
  function removeAd(btn){ const idx=parseInt(btn.getAttribute('data-idx')); let ads=JSON.parse(localStorage.getItem('abbo_ads')||'[]'); if(idx>=0 && idx<ads.length){ ads.splice(idx,1); localStorage.setItem('abbo_ads',JSON.stringify(ads)); loadAll(document.getElementById('filterSelect').value); } }
  function toggleFav(btn){ const idx=parseInt(btn.getAttribute('data-idx')); const ads=JSON.parse(localStorage.getItem('abbo_ads')||'[]'); const ad=ads[idx]; if(!ad)return; let favs=JSON.parse(localStorage.getItem('abbo_favs')||'[]'); const key=ad.dienstNaam+'|'+ad.totaalPrijs+'|'+idx; const exists=favs.find(f=>f.key===key); if(exists){ favs=favs.filter(f=>f.key!==key); } else { favs.push({key,ad}); } localStorage.setItem('abbo_favs',JSON.stringify(favs)); alert(exists?'Verwijderd uit favorieten':'Toegevoegd aan favorieten'); }

  document.getElementById('filterForm').addEventListener('submit', e=>{ e.preventDefault(); loadAll(document.getElementById('filterSelect').value); });
  document.getElementById('resetAll').addEventListener('click', ()=>{ if(confirm('Weet je zeker dat je alle advertenties wilt verwijderen?')){ localStorage.removeItem('abbo_ads'); loadAll('all'); } });

  document.addEventListener('DOMContentLoaded', ()=>{
    let ads=JSON.parse(localStorage.getItem('abbo_ads')||'[]');
    if(ads.length===0){ ads.push({dienstNaam:"Disney+",totaalPrijs:10,ppPrijs:2,totaalMensen:5,vrijePlekken:5,logo:"https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg"}); localStorage.setItem('abbo_ads',JSON.stringify(ads)); }
    loadAll('all');
  });
</script>
</body>
</html>