<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zoeken — AbboMaatjes</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing:border-box; margin:0; padding:0; font-family:'Poppins', sans-serif; }
    body { background:#f5f5f5; color:#333; }

    /* Header */
    .header { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.05); }
    .logo-mark { font-weight:700; font-size:1.5rem; color:#1e5631; cursor:pointer; }
    #siteTitle { font-weight:600; color:#1e5631; cursor:pointer; }
    .header-right a { color:#1e5631; font-weight:600; text-decoration:none; }

    /* Buttons */
    .small-btn { background-color:#1e5631; color:#fff; border:none; border-radius:6px; padding:0.4rem 0.8rem; cursor:pointer; font-weight:600; transition:background 0.2s; }
    .small-btn:hover { background-color:#144220; }

    /* Container */
    .container { max-width:900px; margin:2rem auto; padding:0 1rem; }

    /* Cards */
    .card { background: linear-gradient(135deg, #e6f0ea, #ffffff); border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:1rem 1.5rem; margin-bottom:1rem; }
    .card h2, .card h3 { color:#1e5631; }
    .grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); }

    /* Pills */
    .pills { margin-top:0.5rem; }
    .pill { display:inline-block; width:12px; height:12px; border-radius:50%; margin-right:3px; }
    .pill.taken { background:#144220; } /* donkerder groen */
    .pill.free { background:#1e5631; }

    /* Links */
    .back { display:inline-block; margin-top:1rem; color:#1e5631; text-decoration:none; font-weight:600; }
    .back:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-left" id="homeLink">
      <div class="logo-mark" id="logoMark">€</div>
      <div><h1 id="siteTitle">AbboMaatjes</h1></div>
    </div>
    <div class="header-right" id="headerRight">
      <a class="login-link" href="login.html" id="loginLink">Login</a>
    </div>
  </header>

  <main class="container">
    <div class="card">
      <h2>Advertenties</h2>
      <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
        <form id="filterForm" style="flex:1; display:flex; gap:8px; align-items:center;">
          <label style="margin:0">Filter op dienst</label>
          <select name="dienst" id="filterSelect">
            <option value="all">Alle</option>
            <option value="Netflix">Netflix</option>
            <option value="Spotify Family">Spotify Family</option>
            <option value="Disney+">Disney+</option>
            <option value="Duolingo Family">Duolingo Family</option>
          </select>
          <button class="small-btn" type="submit">Filter</button>
        </form>
        <button id="resetAll" class="small-btn">Verwijder alle advertenties</button>
      </div>
    </div>

    <div id="results" class="grid"></div>

    <a class="back" href="index.html">⬅️ Terug naar homepage</a>
  </main>

  <script>
    document.getElementById('homeLink').addEventListener('click', ()=>{ window.location.href='index.html'; });
    document.getElementById('logoMark').addEventListener('click', ()=>{ window.location.href='index.html'; });
    document.getElementById('siteTitle').addEventListener('click', ()=>{ window.location.href='index.html'; });

    const headerRight = document.getElementById('headerRight');
    const user = JSON.parse(localStorage.getItem('abbo_user')||'null');
    if(user && user.name){
      headerRight.innerHTML = '<div style="font-weight:600">Welkom, '+user.name+'</div>';
    }

    function renderAd(ad, idx){
      const el = document.createElement('div');
      el.className = 'card';
      let pillsHtml = '<div class="pills">';
      const total = parseInt(ad.totaalMensen||0);
      const free = parseInt(ad.vrijePlekken||0);
      const taken = Math.max(0, total - free);
      for(let i=0;i<taken;i++){ pillsHtml += '<span class="pill taken" title="Bezet"></span>'; }
      for(let i=0;i<free;i++){ pillsHtml += '<span class="pill free" title="Vrij"></span>'; }
      pillsHtml += '</div>';

      el.innerHTML = '<div style="display:flex; gap:12px; align-items:center;">' +
                     '<img src="'+(ad.logo || 'https://cdn.simpleicons.org/netflix/E50914')+'" alt="" style="width:56px;height:56px;border-radius:8px;">' +
                     '<div style="flex:1">' +
                     '<h3 style="margin:0">'+ad.dienstNaam+'</h3>' +
                     '<p style="margin:6px 0 0 0">Totaal: €'+ad.totaalPrijs+' — Per persoon: €'+ad.ppPrijs+'</p>' +
                     '</div></div>' +
                     pillsHtml +
                     '<div class="ad-actions"><button class="small-btn" data-idx="'+idx+'" onclick="goDetail(this)">Reageren</button>' +
                     '<button class="small-btn" data-idx="'+idx+'" onclick="toggleFav(this)">Favoriet</button>' +
                     '<button class="small-btn" data-idx="'+idx+'" onclick="removeAd(this)">Verwijder</button></div>';
      return el;
    }

    function loadAll(filter){
      const container = document.getElementById('results');
      container.innerHTML = '';
      const ads = JSON.parse(localStorage.getItem('abbo_ads')||'[]');
      let list = ads;
      if(filter && filter!=='all'){ list = ads.filter(a=>a.dienstNaam===filter); }
      if(list.length===0){ container.innerHTML = '<div class="card">Geen advertenties gevonden.</div>'; return; }
      list.forEach((ad, idx)=>{ container.appendChild(renderAd(ad, idx)); });
    }

    function goDetail(btn){
      const idx = btn.getAttribute('data-idx');
      localStorage.setItem('abbo_selected', idx);
      window.location.href = 'advertentie.html?id='+idx;
    }

    function removeAd(btn){
      const idx = parseInt(btn.getAttribute('data-idx'));
      let ads = JSON.parse(localStorage.getItem('abbo_ads')||'[]');
      if(idx>=0 && idx<ads.length){ ads.splice(idx,1); localStorage.setItem('abbo_ads', JSON.stringify(ads)); loadAll(document.getElementById('filterSelect').value); }
    }

    function toggleFav(btn){
      const idx = parseInt(btn.getAttribute('data-idx'));
      const ads = JSON.parse(localStorage.getItem('abbo_ads')||'[]');
      const ad = ads[idx]; if(!ad) return;
      let favs = JSON.parse(localStorage.getItem('abbo_favs')||'[]');
      const key = ad.dienstNaam + '|' + ad.totaalPrijs + '|' + idx;
      const exists = favs.find(f=>f.key===key);
      if(exists){ favs = favs.filter(f=>f.key!==key); } else { favs.push({key, ad}); }
      localStorage.setItem('abbo_favs', JSON.stringify(favs));
      alert(exists? 'Verwijderd uit favorieten' : 'Toegevoegd aan favorieten');
    }

    document.getElementById('filterForm').addEventListener('submit', e=>{
      e.preventDefault();
      loadAll(document.getElementById('filterSelect').value);
    });

    document.getElementById('resetAll').addEventListener('click', ()=>{
      if(confirm('Weet je zeker dat je alle advertenties wilt verwijderen?')){
        localStorage.removeItem('abbo_ads'); loadAll('all');
      }
    });

    document.addEventListener('DOMContentLoaded', ()=>{
      let ads = JSON.parse(localStorage.getItem('abbo_ads')||'[]');
      if(ads.length === 0){
        ads.push({ dienstNaam:"Disney+", totaalPrijs:10, ppPrijs:2, totaalMensen:5, vrijePlekken:5, logo:"https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg" });
        localStorage.setItem('abbo_ads', JSON.stringify(ads));
      }
      loadAll('all');
    });
  </script>
</body>
</html>